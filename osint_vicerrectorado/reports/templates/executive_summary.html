<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
    <link rel="stylesheet" href="report.css">
</head>
<body>
    <!-- ==================== PORTADA ==================== -->
    <div class="cover-page">
        {% if logo_base64 %}
        <img src="{{ logo_base64 }}" alt="Logo EMI" class="logo">
        {% else %}
        <div class="logo-placeholder">
            <span>EMI</span>
        </div>
        {% endif %}
        
        <h1 class="report-title">{{ report_title }}</h1>
        <p class="report-subtitle">{{ report_subtitle }}</p>
        
        <div class="cover-info">
            <p class="institution">{{ institution }}</p>
            <p class="department">{{ department }}</p>
        </div>
        
        <div class="cover-period">
            <div class="period-box">
                <span class="period-label">Per√≠odo Analizado</span>
                <span class="period-value">{{ period_display }}</span>
            </div>
            <div class="period-box">
                <span class="period-label">Fecha de Generaci√≥n</span>
                <span class="period-value">{{ generated_date }}</span>
            </div>
        </div>
        
        <div class="cover-footer">
            <p>Sistema de Anal√≠tica OSINT</p>
            <p>Documento Confidencial</p>
        </div>
    </div>
    
    <!-- ==================== RESUMEN EJECUTIVO ==================== -->
    {% if 'summary' in sections %}
    <div class="page" id="summary">
        <h2 class="section-title">
            <span class="section-icon">üìä</span>
            Resumen Ejecutivo
        </h2>
        
        <div class="executive-summary">
            <p class="summary-intro">
                Durante el per√≠odo <strong>{{ period_display }}</strong>, el Sistema de Anal√≠tica OSINT 
                recolect√≥ y analiz√≥ <strong>{{ total_posts|format_number }}</strong> publicaciones de redes sociales 
                relacionadas con la Escuela Militar de Ingenier√≠a.
            </p>
            
            <!-- KPIs Principales -->
            <div class="kpi-grid">
                <div class="kpi-card positive">
                    <div class="kpi-icon">üëç</div>
                    <div class="kpi-value">{{ positive_percent }}%</div>
                    <div class="kpi-label">Menciones Positivas</div>
                    <div class="kpi-count">({{ kpis.positive_count|format_number }} posts)</div>
                </div>
                
                <div class="kpi-card negative">
                    <div class="kpi-icon">üëé</div>
                    <div class="kpi-value">{{ negative_percent }}%</div>
                    <div class="kpi-label">Menciones Negativas</div>
                    <div class="kpi-count">({{ kpis.negative_count|format_number }} posts)</div>
                </div>
                
                <div class="kpi-card neutral">
                    <div class="kpi-icon">üòê</div>
                    <div class="kpi-value">{{ neutral_percent }}%</div>
                    <div class="kpi-label">Menciones Neutrales</div>
                    <div class="kpi-count">({{ kpis.neutral_count|format_number }} posts)</div>
                </div>
                
                <div class="kpi-card {% if satisfaction_index >= 60 %}positive{% elif satisfaction_index <= 40 %}negative{% else %}neutral{% endif %}">
                    <div class="kpi-icon">üìà</div>
                    <div class="kpi-value">{{ satisfaction_index }}</div>
                    <div class="kpi-label">√çndice de Satisfacci√≥n</div>
                    <div class="kpi-trend">Tendencia: {{ trend }}</div>
                </div>
            </div>
            
            <!-- Conclusi√≥n r√°pida -->
            <div class="summary-conclusion">
                <h4>Hallazgos Principales</h4>
                <ul>
                    <li>
                        {% if trend == 'creciente' %}
                        <span class="trend-up">‚Üë</span> La percepci√≥n institucional muestra una tendencia positiva sostenida.
                        {% elif trend == 'decreciente' %}
                        <span class="trend-down">‚Üì</span> Se detecta una tendencia a la baja que requiere atenci√≥n.
                        {% else %}
                        <span class="trend-stable">‚Üí</span> La percepci√≥n institucional se mantiene estable.
                        {% endif %}
                    </li>
                    <li>
                        {% if critical_alerts > 0 %}
                        <span class="alert-badge">{{ critical_alerts }}</span> alertas cr√≠ticas requieren atenci√≥n inmediata.
                        {% else %}
                        No se detectaron alertas cr√≠ticas durante el per√≠odo.
                        {% endif %}
                    </li>
                    <li>
                        El engagement promedio fue de <strong>{{ kpis.avg_engagement }}%</strong> sobre el benchmark hist√≥rico.
                    </li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- ==================== AN√ÅLISIS DE SENTIMIENTO ==================== -->
    {% if 'sentiment' in sections and charts.sentiment_evolution %}
    <div class="page" id="sentiment">
        <h2 class="section-title">
            <span class="section-icon">üí¨</span>
            An√°lisis de Sentimiento
        </h2>
        
        <div class="chart-container">
            <h3 class="chart-title">Evoluci√≥n Temporal de Sentimientos</h3>
            <img src="{{ charts.sentiment_evolution }}" alt="Gr√°fico de Evoluci√≥n de Sentimientos" class="chart">
            
            <div class="chart-interpretation">
                <h4>Interpretaci√≥n</h4>
                <p>
                    El gr√°fico muestra la evoluci√≥n diaria de los sentimientos detectados en las publicaciones 
                    durante el per√≠odo analizado. Se observa que:
                </p>
                <ul>
                    <li>Las menciones positivas representan el <strong>{{ positive_percent }}%</strong> del total.</li>
                    <li>Las menciones negativas representan el <strong>{{ negative_percent }}%</strong> del total.</li>
                    <li>Las menciones neutrales (informativas) representan el <strong>{{ neutral_percent }}%</strong>.</li>
                </ul>
            </div>
        </div>
        
        {% if charts.sentiment_distribution %}
        <div class="chart-container half-width">
            <h3 class="chart-title">Distribuci√≥n General</h3>
            <img src="{{ charts.sentiment_distribution }}" alt="Distribuci√≥n de Sentimientos" class="chart">
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- ==================== ALERTAS CR√çTICAS ==================== -->
    {% if 'alerts' in sections and alerts %}
    <div class="page" id="alerts">
        <h2 class="section-title">
            <span class="section-icon">üö®</span>
            Alertas Cr√≠ticas Detectadas
        </h2>
        
        <div class="alerts-summary">
            <p>
                Durante el per√≠odo se detectaron <strong>{{ total_alerts }}</strong> alertas,
                de las cuales <strong>{{ critical_alerts }}</strong> fueron clasificadas como cr√≠ticas.
            </p>
        </div>
        
        <table class="data-table alerts-table">
            <thead>
                <tr>
                    <th width="15%">Severidad</th>
                    <th width="20%">Tipo</th>
                    <th width="40%">Descripci√≥n</th>
                    <th width="15%">Fecha</th>
                    <th width="10%">Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for alert in alerts[:10] %}
                <tr class="severity-{{ alert.severity }}">
                    <td>
                        <span class="severity-badge {{ alert.severity }}">
                            {{ alert.severity|upper }}
                        </span>
                    </td>
                    <td>{{ alert.type }}</td>
                    <td>{{ alert.description }}</td>
                    <td>{{ alert.date|format_date }}</td>
                    <td>{{ alert.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        {% if total_alerts > 10 %}
        <p class="table-note">
            Mostrando 10 de {{ total_alerts }} alertas. Consulte el sistema para el listado completo.
        </p>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- ==================== TOP QUEJAS ==================== -->
    {% if 'complaints' in sections and top_complaints %}
    <div class="page" id="complaints">
        <h2 class="section-title">
            <span class="section-icon">üìù</span>
            Top 10 Quejas Recurrentes
        </h2>
        
        <p class="section-intro">
            A continuaci√≥n se presentan los temas de queja m√°s frecuentes identificados durante el per√≠odo:
        </p>
        
        <div class="complaints-list">
            {% for complaint in top_complaints[:10] %}
            <div class="complaint-item">
                <div class="complaint-rank">#{{ loop.index }}</div>
                <div class="complaint-content">
                    <div class="complaint-topic">{{ complaint.topic }}</div>
                    <div class="complaint-stats">
                        <span class="complaint-count">{{ complaint.count }} menciones</span>
                        <span class="complaint-sentiment {% if complaint.sentiment_avg < -0.5 %}very-negative{% elif complaint.sentiment_avg < 0 %}negative{% else %}neutral{% endif %}">
                            Sentimiento: {{ "%.1f"|format(complaint.sentiment_avg) }}
                        </span>
                    </div>
                </div>
                <div class="complaint-bar-container">
                    <div class="complaint-bar" style="width: {{ (complaint.count / top_complaints[0].count * 100)|round }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="complaints-note">
            <h4>üí° Nota Metodol√≥gica</h4>
            <p>
                Las quejas fueron identificadas mediante an√°lisis de texto con procesamiento de lenguaje natural (NLP),
                agrupando menciones similares y calculando su frecuencia y sentimiento promedio.
            </p>
        </div>
    </div>
    {% endif %}
    
    <!-- ==================== TENDENCIAS POR CARRERA ==================== -->
    {% if 'trends' in sections and career_trends %}
    <div class="page" id="trends">
        <h2 class="section-title">
            <span class="section-icon">üìà</span>
            Tendencias por Carrera
        </h2>
        
        {% if charts.career_comparison %}
        <div class="chart-container">
            <h3 class="chart-title">Comparativa de Satisfacci√≥n por Carrera</h3>
            <img src="{{ charts.career_comparison }}" alt="Comparaci√≥n por Carreras" class="chart">
        </div>
        {% endif %}
        
        <table class="data-table career-table">
            <thead>
                <tr>
                    <th>Carrera</th>
                    <th>√çndice de Satisfacci√≥n</th>
                    <th>Menciones</th>
                    <th>Tendencia</th>
                </tr>
            </thead>
            <tbody>
                {% for career in career_trends %}
                <tr>
                    <td>{{ career.name }}</td>
                    <td>
                        <div class="satisfaction-bar-container">
                            <div class="satisfaction-bar {% if career.satisfaction >= 70 %}high{% elif career.satisfaction >= 50 %}medium{% else %}low{% endif %}"
                                 style="width: {{ career.satisfaction }}%">
                            </div>
                            <span class="satisfaction-value">{{ career.satisfaction }}%</span>
                        </div>
                    </td>
                    <td>{{ career.mentions|format_number }}</td>
                    <td>
                        {% if career.trend == 'up' %}
                        <span class="trend-indicator up">‚Üë Subiendo</span>
                        {% elif career.trend == 'down' %}
                        <span class="trend-indicator down">‚Üì Bajando</span>
                        {% else %}
                        <span class="trend-indicator stable">‚Üí Estable</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <!-- ==================== RECOMENDACIONES ==================== -->
    {% if 'recommendations' in sections and recommendations %}
    <div class="page" id="recommendations">
        <h2 class="section-title">
            <span class="section-icon">üí°</span>
            Recomendaciones
        </h2>
        
        <p class="section-intro">
            Bas√°ndose en el an√°lisis de datos del per√≠odo, se proponen las siguientes acciones:
        </p>
        
        <div class="recommendations-list">
            {% for rec in recommendations %}
            <div class="recommendation-card priority-{{ rec.priority }}">
                <div class="rec-header">
                    <span class="rec-priority {{ rec.priority }}">
                        {% if rec.priority == 'urgente' %}üî¥{% elif rec.priority == 'alta' %}üü†{% else %}üü¢{% endif %}
                        {{ rec.priority|upper }}
                    </span>
                    <span class="rec-area">{{ rec.area }}</span>
                </div>
                <div class="rec-body">
                    <p class="rec-text">{{ rec.recommendation }}</p>
                    <p class="rec-impact"><strong>Impacto esperado:</strong> {{ rec.expected_impact }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- ==================== METODOLOG√çA ==================== -->
    <div class="page appendix" id="methodology">
        <h2 class="section-title">
            <span class="section-icon">üìñ</span>
            Ap√©ndice: Metodolog√≠a
        </h2>
        
        <div class="methodology-content">
            <h3>Fuentes de Datos</h3>
            <p>
                Los datos fueron recolectados de las siguientes fuentes de informaci√≥n p√∫blica:
            </p>
            <ul>
                <li><strong>Facebook:</strong> P√°ginas oficiales e institucionales relacionadas con la EMI</li>
                <li><strong>TikTok:</strong> Cuentas y hashtags relevantes para la comunidad estudiantil</li>
            </ul>
            
            <h3>Procesamiento de Datos</h3>
            <p>
                El pipeline de procesamiento incluye las siguientes etapas:
            </p>
            <ol>
                <li><strong>Recolecci√≥n:</strong> Web scraping automatizado de publicaciones p√∫blicas</li>
                <li><strong>Limpieza:</strong> Normalizaci√≥n de texto, eliminaci√≥n de emojis y URLs</li>
                <li><strong>Clasificaci√≥n:</strong> An√°lisis de sentimiento con modelo BETO (Transformer)</li>
                <li><strong>Agregaci√≥n:</strong> C√°lculo de m√©tricas e indicadores</li>
            </ol>
            
            <h3>Modelo de An√°lisis de Sentimiento</h3>
            <p>
                Se utiliza el modelo BETO (BERT para espa√±ol) fine-tuneado espec√≠ficamente para
                an√°lisis de sentimiento en texto universitario. El modelo clasifica cada texto en:
            </p>
            <ul>
                <li><strong>Positivo:</strong> Expresiones de satisfacci√≥n, apoyo o reconocimiento</li>
                <li><strong>Negativo:</strong> Quejas, cr√≠ticas o expresiones de insatisfacci√≥n</li>
                <li><strong>Neutral:</strong> Menciones informativas sin carga emocional clara</li>
            </ul>
            
            <h3>C√°lculo del √çndice de Satisfacci√≥n</h3>
            <p>
                El √≠ndice de satisfacci√≥n se calcula mediante la f√≥rmula:
            </p>
            <div class="formula">
                IS = min(100, max(0, %Positivos - %Negativos + 50))
            </div>
            <p>
                Donde un valor de 50 indica equilibrio entre menciones positivas y negativas,
                valores superiores indican percepci√≥n favorable y valores inferiores indican
                percepci√≥n desfavorable.
            </p>
            
            <h3>Limitaciones</h3>
            <ul>
                <li>Solo se analizan publicaciones p√∫blicas disponibles</li>
                <li>El an√°lisis de sentimiento tiene un margen de error del ~15%</li>
                <li>No se incluyen mensajes privados ni contenido eliminado</li>
            </ul>
        </div>
    </div>
    
    <!-- ==================== CONTRATAPA ==================== -->
    <div class="back-cover">
        <div class="back-content">
            <p class="confidential-notice">
                Este documento es de car√°cter confidencial y est√° destinado exclusivamente
                para uso interno del Vicerrectorado de Grado de la Escuela Militar de Ingenier√≠a.
            </p>
            
            <div class="generation-info">
                <p><strong>Sistema de Anal√≠tica OSINT</strong></p>
                <p>Versi√≥n: {{ report_version }}</p>
                <p>Generado: {{ generated_date }}</p>
            </div>
            
            <div class="contact-info">
                <p>Para consultas sobre este reporte:</p>
                <p>osint@emi.edu.bo</p>
            </div>
        </div>
    </div>
    
</body>
</html>
